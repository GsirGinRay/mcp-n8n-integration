{
  "name": "LINEé¤å»³æ©Ÿå™¨äºº-è‡ªå­¸ç¿’å„ªåŒ–ç‰ˆ(MCPè¨­è¨ˆ)",
  "active": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "line-restaurant-optimized",
        "options": {
          "rawBody": true
        }
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [120, 240],
      "id": "webhook-receiver",
      "name": "LINE Webhookæ¥æ”¶å™¨",
      "webhookId": "line-restaurant-optimized"
    },
    {
      "parameters": {
        "functionCode": "// [MCPå„ªåŒ–] å¢å¼·å‹è¨Šæ¯è§£æå™¨\n// åŸºæ–¼n8nå°ˆæ¥­æœ€ä½³å¯¦è¸è¨­è¨ˆ\n\nconst body = $input.first().json.body;\nif (!body?.events || body.events.length === 0) {\n  return [];\n}\n\nconst event = body.events[0];\nconst messageData = {\n  // åŸºæœ¬è¨Šæ¯è³‡è¨Š\n  messageText: event.message?.text || '',\n  messageType: event.message?.type || 'unknown',\n  userId: event.source?.userId || 'anonymous',\n  timestamp: new Date(event.timestamp).toISOString(),\n  messageId: event.message?.id || `msg_${Date.now()}`,\n  replyToken: event.replyToken,\n  \n  // [MCPå»ºè­°] å¢å¼·å‹åˆ†æ\n  conversationId: `${event.source?.userId}_${new Date().toDateString()}`,\n  messageLength: (event.message?.text || '').length,\n  hasEmoji: /[\\u{1f300}-\\u{1f5ff}\\u{1f900}-\\u{1f9ff}\\u{1f600}-\\u{1f64f}\\u{1f680}-\\u{1f6ff}\\u{2600}-\\u{26ff}\\u{2700}-\\u{27bf}]/u.test(event.message?.text || ''),\n  \n  // é åˆ†é¡ï¼ˆè‡ªå­¸ç¿’åŸºç¤ï¼‰\n  intentHints: {\n    isGreeting: /^(ä½ å¥½|å—¨|hi|hello)/i.test(event.message?.text || ''),\n    isReservation: /(è¨‚ä½|é ç´„|è¨‚æ¡Œ|booking)/i.test(event.message?.text || ''),\n    isMenu: /(èœå–®|é¤é»|æ¨è–¦|menu|é£Ÿç‰©)/i.test(event.message?.text || ''),\n    isHours: /(ç‡Ÿæ¥­|æ™‚é–“|é–‹åº—|é—œåº—|hours)/i.test(event.message?.text || ''),\n    isDelivery: /(å¤–é€|é€é¤|é…é€|delivery)/i.test(event.message?.text || ''),\n    isContact: /(é›»è©±|åœ°å€|ä½ç½®|è¯çµ¡|contact)/i.test(event.message?.text || '')\n  }\n};\n\nreturn messageData;"
      },
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [320, 240],
      "id": "message-parser",
      "name": "ğŸ§  æ™ºèƒ½è¨Šæ¯è§£æå™¨"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "conversation_history",
          "mode": "list"
        },
        "where": "user_id = '{{ $json.userId }}' AND DATE(created_at) = CURRENT_DATE",
        "orderBy": "created_at DESC",
        "limit": 15
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [520, 140],
      "id": "get-conversation-history",
      "name": "ğŸ“š ç²å–å°è©±æ­·å²",
      "credentials": {
        "supabaseApi": {
          "id": "supabase-restaurant-bot",
          "name": "Supabase Restaurant Bot"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "select", 
        "table": {
          "__rl": true,
          "value": "learning_patterns",
          "mode": "list"
        },
        "where": "category = 'restaurant' AND confidence_score > 0.75 AND is_active = true",
        "orderBy": "confidence_score DESC, usage_count DESC",
        "limit": 25
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [520, 340],
      "id": "get-learning-patterns",
      "name": "ğŸ¯ ç²å–å­¸ç¿’æ¨¡å¼",
      "credentials": {
        "supabaseApi": {
          "id": "supabase-restaurant-bot",
          "name": "Supabase Restaurant Bot"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "user_preferences", 
          "mode": "list"
        },
        "where": "user_id = '{{ $json.userId }}'",
        "limit": 1
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [520, 440],
      "id": "get-user-preferences",
      "name": "ğŸ‘¤ ç²å–ç”¨æˆ¶åå¥½",
      "credentials": {
        "supabaseApi": {
          "id": "supabase-restaurant-bot",
          "name": "Supabase Restaurant Bot"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "// [MCPå„ªåŒ–] æ™ºèƒ½ä¸Šä¸‹æ–‡æ§‹å»ºå™¨\n// æ•´åˆå¤šç¶­åº¦æ•¸æ“šï¼Œæä¾›å€‹äººåŒ–é«”é©—\n\nconst messageData = $node['ğŸ§  æ™ºèƒ½è¨Šæ¯è§£æå™¨'].json;\nconst conversationHistory = $node['ğŸ“š ç²å–å°è©±æ­·å²'].json || [];\nconst learningPatterns = $node['ğŸ¯ ç²å–å­¸ç¿’æ¨¡å¼'].json || [];\nconst userPreferences = $node['ğŸ‘¤ ç²å–ç”¨æˆ¶åå¥½'].json?.[0] || {};\n\n// æ§‹å»ºå¢å¼·ç³»çµ±æç¤º\nlet enhancedPrompt = `ä½ æ˜¯ã€Œå°æ˜çš„é¤å»³ã€çš„å°ˆæ¥­AIå®¢æœåŠ©ç†ï¼Œå…·å‚™è‡ªå­¸ç¿’å’Œå€‹äººåŒ–æœå‹™èƒ½åŠ›ã€‚\n\nã€é¤å»³åŸºæœ¬è³‡è¨Šã€‘\n- åº—åï¼šå°æ˜çš„é¤å»³\n- ç‡Ÿæ¥­æ™‚é–“ï¼šé€±ä¸€è‡³é€±æ—¥ 11:00 - 22:00\n- åœ°å€ï¼šå°åŒ—å¸‚ä¸­å±±å€ä¸­å±±è·¯ 123 è™Ÿ\n- é›»è©±ï¼š02-1234-5678\n- æœå‹™ï¼šå…§ç”¨ã€å¤–å¸¶ã€å¤–é€ï¼ˆ5å…¬é‡Œå…§ï¼‰\n- å¤–é€å¹³å°ï¼šUber Eatsã€Foodpanda\n- æ”¯ä»˜æ–¹å¼ï¼šç¾é‡‘ã€ä¿¡ç”¨å¡ã€Line Payã€Apple Pay\n\nã€ç”¨æˆ¶å€‹äººåŒ–è³‡è¨Šã€‘\\n`;\n\n// åŠ å…¥ç”¨æˆ¶åå¥½\nif (userPreferences.communication_style) {\n  enhancedPrompt += `- åå¥½æºé€šé¢¨æ ¼ï¼š${userPreferences.communication_style}\\n`;\n}\nif (userPreferences.favorite_topics?.length > 0) {\n  enhancedPrompt += `- é—œæ³¨è©±é¡Œï¼š${userPreferences.favorite_topics.join(', ')}\\n`;\n}\nif (userPreferences.total_interactions > 0) {\n  enhancedPrompt += `- äº’å‹•æ¬¡æ•¸ï¼š${userPreferences.total_interactions}æ¬¡ï¼ˆç†Ÿå®¢ï¼‰\\n`;\n}\n\n// åŠ å…¥å­¸ç¿’æ¨¡å¼\nif (learningPatterns.length > 0) {\n  enhancedPrompt += `\\nã€AIå­¸ç¿’æ´å¯Ÿã€‘\\n`;\n  learningPatterns.slice(0, 8).forEach((pattern, index) => {\n    enhancedPrompt += `${index + 1}. ${pattern.pattern_description} (ä¿¡å¿ƒåº¦: ${pattern.confidence_score})\\n`;\n  });\n}\n\n// åŠ å…¥å°è©±æ­·å²æ‘˜è¦\nif (conversationHistory.length > 0) {\n  enhancedPrompt += `\\nã€ä»Šæ—¥å°è©±æ‘˜è¦ã€‘\\n`;\n  conversationHistory.slice(0, 5).forEach(conv => {\n    const time = new Date(conv.created_at).toLocaleTimeString('zh-TW', {hour: '2-digit', minute: '2-digit'});\n    enhancedPrompt += `${time}: \"${conv.user_message.substring(0, 30)}...\" â†’ \"${conv.bot_response?.substring(0, 40)}...\"\\n`;\n  });\n}\n\n// æ™ºèƒ½æ„åœ–åˆ†æ\nconst detectedIntents = Object.entries(messageData.intentHints)\n  .filter(([key, value]) => value)\n  .map(([key, value]) => key);\n\nif (detectedIntents.length > 0) {\n  enhancedPrompt += `\\nã€ç•¶å‰æ„åœ–åˆ†æã€‘\\næª¢æ¸¬åˆ°ï¼š${detectedIntents.join(', ')}\\n`;\n}\n\nenhancedPrompt += `\\nã€å›æ‡‰æŒ‡å°åŸå‰‡ã€‘\n1. åŸºæ–¼ç”¨æˆ¶æ­·å²åå¥½æä¾›å€‹äººåŒ–æœå‹™\n2. åƒè€ƒå­¸ç¿’æ¨¡å¼æä¾›æ›´ç²¾æº–çš„å›ç­”\n3. ä¿æŒè¦ªåˆ‡ã€å°ˆæ¥­ä¸”é«˜æ•ˆçš„æœå‹™æ…‹åº¦\n4. å°æ–¼è¨‚ä½éœ€æ±‚ï¼Œæ”¶é›†ï¼šæ—¥æœŸã€æ™‚é–“ã€äººæ•¸ã€å§“åã€é›»è©±\n5. æ¨è–¦é¤é»æ™‚å„ªå…ˆä»‹ç´¹ï¼šæ‹›ç‰Œç‰›è‚‰éºµã€éº»è¾£ç«é‹ã€èœœæ±çƒ¤é›\n6. é‡åˆ°æ–°å•é¡Œæ™‚è©³ç´°å›ç­”ï¼Œä»¥ä¾¿ç³»çµ±å­¸ç¿’\n\nè«‹é‡å°ç”¨æˆ¶è¨Šæ¯ã€Œ${messageData.messageText}ã€æä¾›æœ€ä½³å›æ‡‰ã€‚`;\n\nreturn {\n  enhancedPrompt,\n  messageContext: {\n    ...messageData,\n    hasHistory: conversationHistory.length > 0,\n    learningPatternsCount: learningPatterns.length,\n    isReturningUser: userPreferences.total_interactions > 0,\n    detectedIntents\n  }\n};"
      },
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [720, 240],
      "id": "context-builder",
      "name": "ğŸ¯ æ™ºèƒ½ä¸Šä¸‹æ–‡æ§‹å»º"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.messageContext.messageText }}",
        "options": {
          "systemMessage": "={{ $json.enhancedPrompt }}",
          "temperature": 0.7,
          "maxTokens": 500
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [920, 240],
      "id": "ai-agent",
      "name": "ğŸ¤– æ™ºèƒ½AIåŠ©æ‰‹"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list"
        },
        "options": {
          "temperature": 0.7,
          "maxTokens": 500,
          "presencePenalty": 0.1,
          "frequencyPenalty": 0.1
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [920, 440],
      "id": "openai-model",
      "name": "ğŸ§  GPT-4o-Miniæ¨¡å‹",
      "credentials": {
        "openAiApi": {
          "id": "openai-restaurant-bot",
          "name": "OpenAI Restaurant Bot"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $node['ğŸ¯ æ™ºèƒ½ä¸Šä¸‹æ–‡æ§‹å»º'].json.messageContext.conversationId }}",
        "contextWindowLength": 25
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [920, 540],
      "id": "enhanced-memory",
      "name": "ğŸ’¾ å¢å¼·è¨˜æ†¶ç³»çµ±"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1flNYeSHD6AOgx0Xvme7L8nngXvJ1vyjOfvfhqvD8tuM",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.6,
      "position": [920, 640],
      "id": "google-sheets-tool",
      "name": "ğŸ“Š Googleè¡¨å–®å·¥å…·",
      "credentials": {
        "googleApi": {
          "id": "google-sheets-restaurant",
          "name": "Google Sheets Restaurant"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "// [MCPå„ªåŒ–] æ™ºèƒ½å­¸ç¿’åˆ†æå™¨\n// åŸºæ–¼å°ˆæ¥­æ¨¡å¼è­˜åˆ¥æ¼”ç®—æ³•\n\nconst messageContext = $node['ğŸ¯ æ™ºèƒ½ä¸Šä¸‹æ–‡æ§‹å»º'].json.messageContext;\nconst aiResponse = $json.output || '';\n\n// é«˜ç´šæ¨¡å¼åˆ†æ\nconst learningAnalysis = {\n  patterns: [],\n  metrics: {\n    responseQuality: 0.8, // é è¨­å“è³ªåˆ†æ•¸\n    userSatisfactionHint: aiResponse.length > 20 ? 0.8 : 0.6,\n    complexityScore: messageContext.messageText.length / 100\n  }\n};\n\n// æ™ºèƒ½æ¨¡å¼è­˜åˆ¥\nif (messageContext.intentHints.isReservation) {\n  learningAnalysis.patterns.push({\n    category: 'restaurant',\n    pattern_type: 'reservation_request',\n    pattern_description: `ç”¨æˆ¶è¨‚ä½åå¥½ï¼š${messageContext.messageLength > 50 ? 'è©³ç´°æè¿°å‹' : 'ç°¡æ½”å‹'}ï¼Œ${messageContext.hasEmoji ? 'ä½¿ç”¨è¡¨æƒ…ç¬¦è™Ÿ' : 'ç´”æ–‡å­—'}`,\n    user_input: messageContext.messageText,\n    bot_response: aiResponse,\n    confidence_score: 0.9,\n    usage_count: 1,\n    success_rate: 0.8,\n    metadata: {\n      messageLength: messageContext.messageLength,\n      hasEmoji: messageContext.hasEmoji,\n      timeOfDay: new Date().getHours()\n    }\n  });\n}\n\nif (messageContext.intentHints.isMenu) {\n  learningAnalysis.patterns.push({\n    category: 'restaurant',\n    pattern_type: 'menu_inquiry',\n    pattern_description: `èœå–®æŸ¥è©¢æ¨¡å¼ï¼š${messageContext.messageText.includes('æ¨è–¦') ? 'å°‹æ±‚æ¨è–¦' : 'ä¸€èˆ¬æŸ¥è©¢'}ï¼Œåå¥½${messageContext.messageLength > 30 ? 'è©³ç´°è³‡è¨Š' : 'ç°¡è¦èªªæ˜'}`,\n    user_input: messageContext.messageText,\n    bot_response: aiResponse,\n    confidence_score: 0.85,\n    usage_count: 1,\n    success_rate: 0.9,\n    metadata: {\n      seekingRecommendation: messageContext.messageText.includes('æ¨è–¦'),\n      specificDish: /ç‰›è‚‰éºµ|ç«é‹|çƒ¤é›/i.test(messageContext.messageText)\n    }\n  });\n}\n\nif (messageContext.intentHints.isDelivery) {\n  learningAnalysis.patterns.push({\n    category: 'restaurant',\n    pattern_type: 'delivery_inquiry',\n    pattern_description: `å¤–é€éœ€æ±‚åˆ†æï¼š${messageContext.messageText.includes('ç¯„åœ') ? 'é—œå¿ƒé…é€ç¯„åœ' : 'åŸºæœ¬å¤–é€æŸ¥è©¢'}`,\n    user_input: messageContext.messageText,\n    bot_response: aiResponse,\n    confidence_score: 0.8,\n    usage_count: 1,\n    success_rate: 0.85\n  });\n}\n\nif (messageContext.intentHints.isHours) {\n  learningAnalysis.patterns.push({\n    category: 'restaurant',\n    pattern_type: 'hours_inquiry',\n    pattern_description: `ç‡Ÿæ¥­æ™‚é–“æŸ¥è©¢ï¼š${new Date().getHours() < 11 || new Date().getHours() > 22 ? 'éç‡Ÿæ¥­æ™‚é–“æŸ¥è©¢' : 'ç‡Ÿæ¥­ä¸­æŸ¥è©¢'}`,\n    user_input: messageContext.messageText,\n    bot_response: aiResponse,\n    confidence_score: 0.75,\n    usage_count: 1,\n    success_rate: 0.95\n  });\n}\n\n// æƒ…æ„Ÿåˆ†æï¼ˆç°¡åŒ–ç‰ˆï¼‰\nconst positiveWords = ['å¥½', 'æ£’', 'è®š', 'å–œæ­¡', 'æ»¿æ„', 'è¬è¬'];\nconst negativeWords = ['ä¸å¥½', 'çˆ›', 'å·®', 'ä¸æ»¿', 'æŠ±æ€¨', 'å•é¡Œ'];\n\nconst sentiment = {\n  positive: positiveWords.some(word => messageContext.messageText.includes(word)),\n  negative: negativeWords.some(word => messageContext.messageText.includes(word)),\n  neutral: true\n};\n\nif (sentiment.positive || sentiment.negative) {\n  learningAnalysis.patterns.push({\n    category: 'restaurant',\n    pattern_type: 'customer_feedback',\n    pattern_description: `å®¢æˆ¶å›é¥‹ï¼š${sentiment.positive ? 'æ­£é¢' : 'è² é¢'}æƒ…æ„Ÿè¡¨é”`,\n    user_input: messageContext.messageText,\n    bot_response: aiResponse,\n    confidence_score: 0.7,\n    usage_count: 1,\n    success_rate: sentiment.positive ? 0.9 : 0.6\n  });\n}\n\nreturn {\n  shouldLearn: learningAnalysis.patterns.length > 0,\n  learningData: learningAnalysis.patterns,\n  conversationData: {\n    user_id: messageContext.userId,\n    message_id: messageContext.messageId,\n    user_message: messageContext.messageText,\n    bot_response: aiResponse,\n    message_type: 'text',\n    intent_detected: messageContext.detectedIntents.join(','),\n    response_quality_score: learningAnalysis.metrics.responseQuality,\n    timestamp: messageContext.timestamp\n  },\n  analyticsData: {\n    user_id: messageContext.userId,\n    message_type: 'user_query',\n    content_analysis: {\n      messageLength: messageContext.messageLength,\n      hasEmoji: messageContext.hasEmoji,\n      detectedIntents: messageContext.detectedIntents,\n      sentiment: sentiment,\n      complexity: learningAnalysis.metrics.complexityScore\n    },\n    response_time: Date.now() - new Date(messageContext.timestamp).getTime(),\n    satisfaction_estimate: learningAnalysis.metrics.userSatisfactionHint\n  }\n};"
      },
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1120, 240],
      "id": "learning-analyzer",
      "name": "ğŸ§  æ™ºèƒ½å­¸ç¿’åˆ†æ"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "insert",
        "table": {
          "__rl": true,
          "value": "conversation_history",
          "mode": "list"
        },
        "records": "={{ [$json.conversationData] }}"
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [1320, 140],
      "id": "save-conversation",
      "name": "ğŸ’¾ ä¿å­˜å°è©±è¨˜éŒ„",
      "credentials": {
        "supabaseApi": {
          "id": "supabase-restaurant-bot",
          "name": "Supabase Restaurant Bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.shouldLearn }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "true"
              }
            }
          ]
        }
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1320, 240],
      "id": "should-learn-check",
      "name": "ğŸ¤” éœ€è¦å­¸ç¿’å—ï¼Ÿ"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "insert",
        "table": {
          "__rl": true,
          "value": "learning_patterns",
          "mode": "list"
        },
        "records": "={{ $json.learningData }}"
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [1520, 200],
      "id": "save-learning-patterns",
      "name": "ğŸ“š ä¿å­˜å­¸ç¿’æ¨¡å¼",
      "credentials": {
        "supabaseApi": {
          "id": "supabase-restaurant-bot",
          "name": "Supabase Restaurant Bot"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "insert",
        "table": {
          "__rl": true,
          "value": "analytics_data",
          "mode": "list"
        },
        "records": "={{ [$json.analyticsData] }}"
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [1320, 340],
      "id": "save-analytics",
      "name": "ğŸ“Š ä¿å­˜åˆ†ææ•¸æ“š",
      "credentials": {
        "supabaseApi": {
          "id": "supabase-restaurant-bot",
          "name": "Supabase Restaurant Bot"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "upsert",
        "table": {
          "__rl": true,
          "value": "user_preferences",
          "mode": "list"
        },
        "records": [{
          "user_id": "={{ $node['ğŸ§  æ™ºèƒ½å­¸ç¿’åˆ†æ'].json.conversationData.user_id }}",
          "total_interactions": "={{ ($node['ğŸ‘¤ ç²å–ç”¨æˆ¶åå¥½'].json?.[0]?.total_interactions || 0) + 1 }}",
          "last_interaction": "={{ new Date().toISOString() }}",
          "communication_style": "friendly",
          "preferred_response_length": "medium"
        }],
        "onConflict": "user_id"
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [1320, 440],
      "id": "update-user-preferences",
      "name": "ğŸ‘¤ æ›´æ–°ç”¨æˆ¶åå¥½",
      "credentials": {
        "supabaseApi": {
          "id": "supabase-restaurant-bot",
          "name": "Supabase Restaurant Bot"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"replyToken\": \"{{ $node['ğŸ¯ æ™ºèƒ½ä¸Šä¸‹æ–‡æ§‹å»º'].json.messageContext.replyToken }}\",\n    \"messages\": [\n        {\n            \"type\": \"text\",\n            \"text\": \"{{ $node['ğŸ¤– æ™ºèƒ½AIåŠ©æ‰‹'].json.output.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"').replace(/\\r?\\n/g, '\\\\n') }}\"\n        }\n    ]\n}",
        "options": {
          "timeout": 10000,\n          "retry": {\n            \"enabled\": true,\n            \"maxRetries\": 3\n          }\n        }\n      },\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.2,\n      \"position\": [1120, 440],\n      \"id\": \"line-reply\",\n      \"name\": \"ğŸ“± LINEæ™ºèƒ½å›è¦†\",\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"line-bot-restaurant\",\n          \"name\": \"LINE Bot Restaurant\"\n        }\n      }\n    },\n    {\n      \"parameters\": {\n        \"conditions\": {\n          \"options\": {\n            \"caseSensitive\": true,\n            \"leftValue\": \"\",\n            \"typeValidation\": \"strict\"\n          },\n          \"conditions\": [\n            {\n              \"leftValue\": \"={{ $node['ğŸ“± LINEæ™ºèƒ½å›è¦†'].json.statusCode }}\",\n              \"rightValue\": 200,\n              \"operator\": {\n                \"type\": \"number\",\n                \"operation\": \"equals\"\n              }\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.if\",\n      \"typeVersion\": 2,\n      \"position\": [1320, 540],\n      \"id\": \"reply-success-check\",\n      \"name\": \"âœ… å›è¦†æˆåŠŸï¼Ÿ\"\n    },\n    {\n      \"parameters\": {\n        \"authentication\": \"serviceAccount\",\n        \"operation\": \"insert\",\n        \"table\": {\n          \"__rl\": true,\n          \"value\": \"system_logs\",\n          \"mode\": \"list\"\n        },\n        \"records\": [{\n          \"log_type\": \"reply_success\",\n          \"user_id\": \"={{ $node['ğŸ§  æ™ºèƒ½å­¸ç¿’åˆ†æ'].json.conversationData.user_id }}\",\n          \"message\": \"LINEå›è¦†ç™¼é€æˆåŠŸ\",\n          \"metadata\": \"={{ JSON.stringify({statusCode: $node['ğŸ“± LINEæ™ºèƒ½å›è¦†'].json.statusCode, timestamp: new Date().toISOString()}) }}\",\n          \"created_at\": \"={{ new Date().toISOString() }}\"\n        }]\n      },\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"typeVersion\": 1,\n      \"position\": [1520, 500],\n      \"id\": \"log-success\",\n      \"name\": \"ğŸ“ è¨˜éŒ„æˆåŠŸæ—¥èªŒ\",\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"supabase-restaurant-bot\",\n          \"name\": \"Supabase Restaurant Bot\"\n        }\n      }\n    }\n  ],\n  \"connections\": {\n    \"LINE Webhookæ¥æ”¶å™¨\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ğŸ§  æ™ºèƒ½è¨Šæ¯è§£æå™¨\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ğŸ§  æ™ºèƒ½è¨Šæ¯è§£æå™¨\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ğŸ“š ç²å–å°è©±æ­·å²\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"ğŸ¯ ç²å–å­¸ç¿’æ¨¡å¼\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"ğŸ‘¤ ç²å–ç”¨æˆ¶åå¥½\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ğŸ“š ç²å–å°è©±æ­·å²\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ğŸ¯ æ™ºèƒ½ä¸Šä¸‹æ–‡æ§‹å»º\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ğŸ¯ ç²å–å­¸ç¿’æ¨¡å¼\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ğŸ¯ æ™ºèƒ½ä¸Šä¸‹æ–‡æ§‹å»º\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ğŸ‘¤ ç²å–ç”¨æˆ¶åå¥½\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ğŸ¯ æ™ºèƒ½ä¸Šä¸‹æ–‡æ§‹å»º\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ğŸ¯ æ™ºèƒ½ä¸Šä¸‹æ–‡æ§‹å»º\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ğŸ¤– æ™ºèƒ½AIåŠ©æ‰‹\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ğŸ¤– æ™ºèƒ½AIåŠ©æ‰‹\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ğŸ§  æ™ºèƒ½å­¸ç¿’åˆ†æ\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"ğŸ“± LINEæ™ºèƒ½å›è¦†\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ğŸ§  æ™ºèƒ½å­¸ç¿’åˆ†æ\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ğŸ’¾ ä¿å­˜å°è©±è¨˜éŒ„\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"ğŸ¤” éœ€è¦å­¸ç¿’å—ï¼Ÿ\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"ğŸ“Š ä¿å­˜åˆ†ææ•¸æ“š\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"ğŸ‘¤ æ›´æ–°ç”¨æˆ¶åå¥½\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ğŸ¤” éœ€è¦å­¸ç¿’å—ï¼Ÿ\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ğŸ“š ä¿å­˜å­¸ç¿’æ¨¡å¼\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ğŸ“± LINEæ™ºèƒ½å›è¦†\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"âœ… å›è¦†æˆåŠŸï¼Ÿ\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"âœ… å›è¦†æˆåŠŸï¼Ÿ\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ğŸ“ è¨˜éŒ„æˆåŠŸæ—¥èªŒ\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ğŸ§  GPT-4o-Miniæ¨¡å‹\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"ğŸ¤– æ™ºèƒ½AIåŠ©æ‰‹\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ğŸ’¾ å¢å¼·è¨˜æ†¶ç³»çµ±\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"ğŸ¤– æ™ºèƒ½AIåŠ©æ‰‹\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ğŸ“Š Googleè¡¨å–®å·¥å…·\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"ğŸ¤– æ™ºèƒ½AIåŠ©æ‰‹\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  },\n  \"settings\": {\n    \"executionOrder\": \"v1\",\n    \"saveManualExecutions\": true,\n    \"callerPolicy\": \"workflowsFromSameOwner\"\n  },\n  \"staticData\": null,\n  \"meta\": {\n    \"templateCredsSetupCompleted\": false,\n    \"instanceId\": \"self-learning-restaurant-bot\"\n  },\n  \"pinData\": {},\n  \"versionId\": \"optimized-v1\",\n  \"triggerCount\": 1,\n  \"tags\": [\"mcp-optimized\", \"self-learning\", \"restaurant\", \"line-bot\", \"supabase\"]\n}"